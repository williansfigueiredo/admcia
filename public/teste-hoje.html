<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Vencimento HOJE - 18/02/2026</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .resultado {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .erro {
            border-left-color: #dc3545;
            background: #ffe6e6;
        }
        .sucesso {
            border-left-color: #28a745;
            background: #e6ffe6;
        }
        code {
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>üîç Teste de Alerta de Vencimento - HOJE 18/02/2026</h1>
    
    <div id="testes"></div>

    <script>
        // Copia a fun√ß√£o exata do main.js
        window.calcularAlertaVencimento = function(dataVencimento, status) {
          console.log('üîî calcularAlertaVencimento chamada:', { dataVencimento, status });
          
          if (status === 'pago' || status === 'cancelado' || status === 'atrasado' || status === 'Pago' || status === 'Cancelado' || status === 'Vencido') {
            console.log('‚è≠Ô∏è Status bloqueado (j√° pago/cancelado/vencido):', status);
            return '';
          }
          
          if (!dataVencimento) {
            console.log('‚è≠Ô∏è Sem data de vencimento');
            return '';
          }
          
          try {
            // Pega data de hoje (apenas dia, sem horas) - USA HOR√ÅRIO LOCAL, N√ÉO UTC!
            const hoje = new Date();
            const ano = hoje.getFullYear();
            const mes = String(hoje.getMonth() + 1).padStart(2, '0');
            const dia = String(hoje.getDate()).padStart(2, '0');
            const hojeStr = `${ano}-${mes}-${dia}`; // YYYY-MM-DD em hor√°rio local
            
            let vencimentoStr = dataVencimento;
            if (typeof dataVencimento === 'object' && dataVencimento !== null) {
              const d = new Date(dataVencimento);
              const vAno = d.getFullYear();
              const vMes = String(d.getMonth() + 1).padStart(2, '0');
              const vDia = String(d.getDate()).padStart(2, '0');
              vencimentoStr = `${vAno}-${vMes}-${vDia}`;
            } else if (typeof dataVencimento === 'string') {
              if (dataVencimento.includes('/')) {
                const [dia, mes, ano] = dataVencimento.split('/');
                vencimentoStr = `${ano}-${mes.padStart(2, '0')}-${dia.padStart(2, '0')}`;
              } else {
                const d = new Date(dataVencimento);
                const vAno = d.getFullYear();
                const vMes = String(d.getMonth() + 1).padStart(2, '0');
                const vDia = String(d.getDate()).padStart(2, '0');
                vencimentoStr = `${vAno}-${vMes}-${vDia}`;
              }
            }
            
            const hojeDate = new Date(hojeStr + 'T00:00:00');
            const vencimentoDate = new Date(vencimentoStr + 'T00:00:00');
            
            if (isNaN(vencimentoDate.getTime())) {
              console.error('‚ùå Data de vencimento inv√°lida:', dataVencimento);
              return '';
            }
            
            const diffTime = vencimentoDate.getTime() - hojeDate.getTime();
            const diffDays = Math.round(diffTime / (1000 * 60 * 60 * 24));
            
            console.log('üîî Alerta vencimento calculado:', { 
              dataVencimento, 
              status, 
              hoje: hojeStr,
              vencimento: vencimentoStr,
              diffDays,
              hojeDate: hojeDate.toISOString(),
              vencimentoDate: vencimentoDate.toISOString()
            });
            
            if (diffDays < 0) {
              console.log('‚è≠Ô∏è Data j√° passou (diffDays < 0)');
              return '';
            } else if (diffDays === 0) {
              console.log('‚ö†Ô∏è VENCE HOJE! Retornando alerta');
              return '<span class="ms-1" title="‚ö†Ô∏è VENCE HOJE!" style="color: #dc3545; font-size: 1.2em; cursor: default; display: inline-block; vertical-align: middle;">‚ö†Ô∏è</span>';
            } else if (diffDays === 1) {
              console.log('‚ö†Ô∏è Vence amanh√£! Retornando alerta');
              return '<span class="ms-1" title="‚ö†Ô∏è Vence amanh√£" style="color: #ffc107; font-size: 1.1em; cursor: default; display: inline-block; vertical-align: middle;">‚ö†Ô∏è</span>';
            } else if (diffDays === 2) {
              console.log('‚ö†Ô∏è Vence em 2 dias! Retornando alerta');
              return '<span class="ms-1" title="‚ö†Ô∏è Vence em 2 dias" style="color: #ffc107; font-size: 1.05em; cursor: default; display: inline-block; vertical-align: middle;">‚ö†Ô∏è</span>';
            }
            
            console.log('‚è≠Ô∏è Fora do range de alerta (diffDays:', diffDays, ')');
            return '';
          } catch (error) {
            console.error('‚ùå Erro ao calcular alerta:', error, dataVencimento);
            return '';
          }
        };

        // Testes
        const testes = [
            {
                nome: "18/02/2026 formato brasileiro (HOJE)",
                data: "18/02/2026",
                status: "Pendente",
                esperado: "VERMELHO (diffDays = 0)"
            },
            {
                nome: "2026-02-18 formato ISO (HOJE)",
                data: "2026-02-18",
                status: "Pendente",
                esperado: "VERMELHO (diffDays = 0)"
            },
            {
                nome: "2026-02-18T00:00:00 formato ISO completo (HOJE)",
                data: "2026-02-18T00:00:00",
                status: "Pendente",
                esperado: "VERMELHO (diffDays = 0)"
            },
            {
                nome: "2026-02-18T03:00:00.000Z formato do MySQL (HOJE)",
                data: "2026-02-18T03:00:00.000Z",
                status: "Pendente",
                esperado: "VERMELHO (diffDays = 0)"
            },
            {
                nome: "19/02/2026 (AMANH√É)",
                data: "19/02/2026",
                status: "Pendente",
                esperado: "AMARELO (diffDays = 1)"
            },
            {
                nome: "20/02/2026 (EM 2 DIAS)",
                data: "20/02/2026",
                status: "Pendente",
                esperado: "AMARELO (diffDays = 2)"
            }
        ];

        const container = document.getElementById('testes');
        
        testes.forEach(teste => {
            console.log('\n=== TESTE:', teste.nome, '===');
            const resultado = calcularAlertaVencimento(teste.data, teste.status);
            
            const div = document.createElement('div');
            div.className = 'resultado';
            
            if (resultado) {
                div.className += ' sucesso';
                div.innerHTML = `
                    <h3>‚úÖ ${teste.nome}</h3>
                    <p><strong>Data:</strong> <code>${teste.data}</code></p>
                    <p><strong>Status:</strong> <code>${teste.status}</code></p>
                    <p><strong>Esperado:</strong> ${teste.esperado}</p>
                    <p><strong>Resultado:</strong> ${resultado}</p>
                `;
            } else {
                div.className += ' erro';
                div.innerHTML = `
                    <h3>‚ùå ${teste.nome}</h3>
                    <p><strong>Data:</strong> <code>${teste.data}</code></p>
                    <p><strong>Status:</strong> <code>${teste.status}</code></p>
                    <p><strong>Esperado:</strong> ${teste.esperado}</p>
                    <p><strong>‚ùå NENHUM ALERTA RETORNADO!</strong></p>
                `;
            }
            
            container.appendChild(div);
        });

        console.log('\nüìÖ Data de hoje:', new Date().toISOString());
        console.log('üìÖ Data sem timezone:', new Date().toISOString().split('T')[0]);
    </script>
</body>
</html>
