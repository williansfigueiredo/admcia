<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Vencimento</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            background: #f5f5f5;
        }
        .test-box {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 { color: #333; }
        h2 { color: #666; }
        .result {
            padding: 10px;
            margin: 10px 0;
            background: #f0f0f0;
            border-left: 4px solid #007bff;
        }
        .success { border-left-color: #28a745; }
        .error { border-left-color: #dc3545; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>üîç Teste de C√°lculo de Vencimento</h1>
    
    <div class="test-box">
        <h2>Data de Hoje</h2>
        <div id="dataHoje" class="result"></div>
    </div>

    <div class="test-box">
        <h2>Testes de Vencimento</h2>
        <button onclick="rodarTestes()">‚ñ∂Ô∏è Rodar Testes</button>
        <div id="resultados"></div>
    </div>

    <div class="test-box">
        <h2>Teste Personalizado</h2>
        <input type="date" id="dataInput" value="2026-02-18">
        <select id="statusInput">
            <option value="Pendente">Pendente</option>
            <option value="Em Progresso">Em Progresso</option>
            <option value="Pago">Pago</option>
            <option value="Vencido">Vencido</option>
        </select>
        <button onclick="testarCustom()">Testar</button>
        <div id="resultadoCustom" class="result"></div>
    </div>

    <script>
        // Fun√ß√£o de c√°lculo de vencimento (copiada de main.js)
        window.calcularAlertaVencimento = function(dataVencimento, status) {
          // N√£o mostra alerta se j√° est√° pago, cancelado ou vencido
          if (status === 'pago' || status === 'cancelado' || status === 'atrasado' || status === 'Pago' || status === 'Cancelado' || status === 'Vencido') {
            return '';
          }
          
          if (!dataVencimento) {
            return '';
          }
          
          try {
            // Pega data de hoje (apenas dia, sem horas)
            const hoje = new Date();
            const hojeStr = hoje.toISOString().split('T')[0]; // YYYY-MM-DD
            
            // Trata a data de vencimento - pode vir como string ou Date
            let vencimentoStr = dataVencimento;
            if (typeof dataVencimento === 'object' && dataVencimento !== null) {
              vencimentoStr = new Date(dataVencimento).toISOString().split('T')[0];
            } else if (typeof dataVencimento === 'string') {
              // Se vier no formato brasileiro (DD/MM/YYYY), converte para YYYY-MM-DD
              if (dataVencimento.includes('/')) {
                const [dia, mes, ano] = dataVencimento.split('/');
                vencimentoStr = `${ano}-${mes.padStart(2, '0')}-${dia.padStart(2, '0')}`;
              } else {
                vencimentoStr = dataVencimento.split('T')[0]; // Remove timezone se existir
              }
            }
            
            // Cria objetos Date apenas com a data, sem hora (evita problema de timezone)
            const hojeDate = new Date(hojeStr + 'T00:00:00');
            const vencimentoDate = new Date(vencimentoStr + 'T00:00:00');
            
            if (isNaN(vencimentoDate.getTime())) {
              console.error('‚ùå Data de vencimento inv√°lida:', dataVencimento);
              return '';
            }
            
            // Calcula diferen√ßa em dias (usando apenas as datas, sem horas)
            const diffTime = vencimentoDate.getTime() - hojeDate.getTime();
            const diffDays = Math.round(diffTime / (1000 * 60 * 60 * 24));
            
            console.log('üîî Alerta vencimento:', { 
              dataVencimento, 
              status, 
              hoje: hojeStr,
              vencimento: vencimentoStr,
              diffDays 
            });
            
            // Alertas com √≠cone ‚ö†Ô∏è
            if (diffDays < 0) {
              // J√° passou (n√£o mostra, pois status j√° deve ser "Vencido")
              return '';
            } else if (diffDays === 0) {
              // Vence HOJE - VERMELHO
              return '<span class="ms-1" title="‚ö†Ô∏è VENCE HOJE!" style="color: #dc3545; font-size: 1.2em; cursor: default; display: inline-block; vertical-align: middle;">‚ö†Ô∏è</span>';
            } else if (diffDays === 1) {
              // Vence amanh√£ - AMARELO
              return '<span class="ms-1" title="‚ö†Ô∏è Vence amanh√£" style="color: #ffc107; font-size: 1.1em; cursor: default; display: inline-block; vertical-align: middle;">‚ö†Ô∏è</span>';
            } else if (diffDays === 2) {
              // Vence em 2 dias - AMARELO
              return '<span class="ms-1" title="‚ö†Ô∏è Vence em 2 dias" style="color: #ffc107; font-size: 1.05em; cursor: default; display: inline-block; vertical-align: middle;">‚ö†Ô∏è</span>';
            }
            
            return '';
          } catch (error) {
            console.error('‚ùå Erro ao calcular alerta:', error, dataVencimento);
            return '';
          }
        };

        // Exibe data de hoje
        const hoje = new Date();
        document.getElementById('dataHoje').innerHTML = `
            <strong>Hoje √©:</strong> ${hoje.toLocaleDateString('pt-BR')} <br>
            <strong>ISO:</strong> ${hoje.toISOString().split('T')[0]}
        `;

        // Rodar testes autom√°ticos
        function rodarTestes() {
            const hoje = new Date();
            const hojeISO = hoje.toISOString().split('T')[0];
            const amanha = new Date(hoje);
            amanha.setDate(hoje.getDate() + 1);
            const amanhaISO = amanha.toISOString().split('T')[0];
            const depoisAmanha = new Date(hoje);
            depoisAmanha.setDate(hoje.getDate() + 2);
            const depoisAmanhaISO = depoisAmanha.toISOString().split('T')[0];
            const ontem = new Date(hoje);
            ontem.setDate(hoje.getDate() - 1);
            const ontemISO = ontem.toISOString().split('T')[0];

            const testes = [
                { data: hojeISO, status: 'Pendente', esperado: '‚ö†Ô∏è VENCE HOJE!', desc: 'Vence Hoje (Pendente)' },
                { data: hojeISO, status: 'Pago', esperado: '', desc: 'Vence Hoje mas j√° Pago (n√£o mostra)' },
                { data: amanhaISO, status: 'Pendente', esperado: '‚ö†Ô∏è Vence amanh√£', desc: 'Vence Amanh√£' },
                { data: depoisAmanhaISO, status: 'Pendente', esperado: '‚ö†Ô∏è Vence em 2 dias', desc: 'Vence em 2 dias' },
                { data: ontemISO, status: 'Pendente', esperado: '', desc: 'J√° passou (deveria ser Vencido)' },
                { data: '18/02/2026', status: 'Pendente', esperado: '‚ö†Ô∏è VENCE HOJE!', desc: 'Formato BR - Hoje' },
            ];

            let html = '<h3>Resultados:</h3>';
            testes.forEach((teste, i) => {
                const resultado = window.calcularAlertaVencimento(teste.data, teste.status);
                const passou = resultado.includes(teste.esperado) || (teste.esperado === '' && resultado === '');
                const classe = passou ? 'success' : 'error';
                
                html += `
                    <div class="result ${classe}">
                        <strong>Teste ${i + 1}:</strong> ${teste.desc}<br>
                        <strong>Data:</strong> ${teste.data} | <strong>Status:</strong> ${teste.status}<br>
                        <strong>Esperado:</strong> ${teste.esperado || '(nada)'}<br>
                        <strong>Obtido:</strong> ${resultado || '(nada)'}<br>
                        <strong>Resultado:</strong> ${passou ? '‚úÖ PASSOU' : '‚ùå FALHOU'}
                    </div>
                `;
            });

            document.getElementById('resultados').innerHTML = html;
        }

        // Teste personalizado
        function testarCustom() {
            const data = document.getElementById('dataInput').value;
            const status = document.getElementById('statusInput').value;
            const resultado = window.calcularAlertaVencimento(data, status);
            
            document.getElementById('resultadoCustom').innerHTML = `
                <strong>Resultado:</strong><br>
                Data: ${data}<br>
                Status: ${status}<br>
                Alerta: ${resultado || '(nenhum alerta)'}<br>
                HTML: <pre>${resultado.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</pre>
            `;
        }

        // Roda os testes automaticamente ao carregar
        window.onload = function() {
            rodarTestes();
        };
    </script>
</body>
</html>
